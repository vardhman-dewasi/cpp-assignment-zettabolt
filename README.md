# TPC-H Query 5 Implementation in C++ (Multithreaded)

This project implements TPC-H Query 5 ("Local Supplier Volume") in C++ using multithreading and raw `.tbl` data files generated by the TPC-H `dbgen` tool.

---

## ğŸ“¦ Project Features

* Fully in-memory processing (no DBMS)
* CLI-based parameter control (region, date range, thread count, paths)
* Multithreaded order processing for better performance
* Outputs sorted revenue per nation

---

## ğŸ›  Dependencies

* C++17 or later
* Standard C++ STL libraries (no external dependencies)

---

## ğŸ“ Project Structure

```
tpch_q5_project/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ tpch_structs.h         # Struct definitions for all tables
â”‚   â”œâ”€â”€ file_reader.h          # Data loading from .tbl files
â”‚   â””â”€â”€ cli_parser.h           # CLI argument parser header
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ file_reader.cpp        # Implementations to load tables
â”‚   â””â”€â”€ cli_parser.cpp         # CLI argument parsing logic
â”‚
â”œâ”€â”€ data/                      # Directory containing .tbl files (generated from dbgen)
â”œâ”€â”€ main.cpp                   # Main multithreaded logic + CLI integration
â”œâ”€â”€ output.txt                 # Output results after execution
â””â”€â”€ README.md                  # Project explanation & setup instructions
```

---

## âš™ï¸ Steps to Run the Project

### 1. Clone or Download

```bash
git clone <your-repo-url>
cd tpch_q5_project
```

### 2. Generate TPC-H Data (Optional if you already have `.tbl` files)

* Download and compile `dbgen` tool from the TPC-H benchmark.
* Generate data:

```bash
./dbgen -s 1     # Generate SF1 (scale factor 1) dataset
```

* Move all `.tbl` files to the `./data/` directory of your project.

### 3. Compile the Project

```bash
g++ -std=c++17 -O2 -pthread main.cpp src/cli_parser.cpp src/file_reader.cpp -o tpch_q5
```

### 4. Run the Executable

```bash
./tpch_q5 ASIA 1995-01-01 1996-01-01 4 ./data/ output.txt
```

### CLI Parameters:

```
<REGION>        : Region name to filter (e.g., ASIA)
<START_DATE>    : Start of order date (inclusive)
<END_DATE>      : End of order date (exclusive)
<NUM_THREADS>   : Number of threads for processing
<DATA_DIR>      : Path to directory containing .tbl files
<OUTPUT_PATH>   : Output file path for final result
```

---

## ğŸ“¤ Sample Output (`output.txt`)

```
Final Revenue by Nation (in ASIA, 1995):
INDIA: 51234000.45
CHINA: 50122344.20
...
Execution Time: 0.562 seconds
```

---

## ğŸ§  How It Works - Step-by-Step

### Step 1: Data Preparation

* Use `dbgen` to generate `.tbl` files for tables: region, nation, customer, supplier, orders, lineitem.

### Step 2: Read Data

* Custom parsers read each `.tbl` file and convert rows into `struct` vectors.

### Step 3: CLI Interface

* User provides region, date range, thread count, paths.
* Parameters are parsed using `cli_parser.cpp`.

### Step 4: Multithreaded Processing

* Orders are divided among N threads.
* Each thread:

  * Filters orders by date range and region
  * Joins with customer, nation, supplier
  * Calculates local revenue

### Step 5: Aggregate & Output

* Mutex protects shared revenue map.
* Final results are sorted and written to `output.txt`.

---

## ğŸ§¾ Credits

* TPC-H Benchmark ([www.tpc.org](http://www.tpc.org))
* Designed and implemented by Vardhman (2025)

---

## ğŸ“© Questions?

Feel free to reach out or fork this repo to build on it!
